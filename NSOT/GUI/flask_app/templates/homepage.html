{% extends "base.html" %}
{% block title %}NAutoHUB - Network Automation Hub{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="homepage-hero">
  <h1 class="homepage-title">Network Automation Hub</h1>
  <p class="homepage-subtitle">Build, configure, manage, and monitor your network infrastructure with ease</p>
</div>

<!-- Rollback Section -->
<div class="rollback-banner">
  <div class="rollback-content">
    <div class="rollback-icon">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="1 4 1 10 7 10"/>
        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
      </svg>
    </div>
    <div class="rollback-info">
      <h3 class="rollback-title">Configuration Rollback</h3>
      <p class="rollback-desc">Instantly restore devices to their golden configuration</p>
    </div>
    <button class="btn-rollback" onclick="showRollbackModal()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="1 4 1 10 7 10"/>
        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
      </svg>
      Rollback Device
    </button>
  </div>
</div>

<!-- Rollback Modal -->
<div class="modal-overlay" id="rollbackModal" style="display: none;" onclick="closeRollbackModal(event)">
  <div class="rollback-modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">Rollback to Golden Configuration</h2>
      <button class="modal-close" onclick="closeRollbackModal()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Device</label>
        <select id="rollbackDevice" class="form-select">
          <option value="">Select Device</option>
          {% for device in devices %}
          <option value="{{ device }}">{{ device }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Vendor</label>
        <select id="rollbackVendor" class="form-select">
          <option value="">Select Vendor</option>
          <option value="arista">Arista</option>
          <option value="cisco">Cisco</option>
          <option value="juniper">Juniper</option>
        </select>
      </div>
      <div class="alert alert-warning" style="margin-top: var(--space-4);">
        <span class="alert-icon">⚠️</span>
        <div class="alert-content">
          <strong>Warning:</strong> This will restore the device to its last saved golden configuration. Any changes made after the backup will be lost.
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeRollbackModal()">Cancel</button>
      <button class="btn btn-danger" onclick="executeRollback()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="1 4 1 10 7 10"/>
          <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
        </svg>
        Execute Rollback
      </button>
    </div>
  </div>
</div>

<!-- Pipeline Navigation -->
<div class="pipeline-container">
  <!-- Pipeline Header -->
  <div class="pipeline-header">
    <div class="pipeline-label">NMAS</div>
    <div class="pipeline-connector-line"></div>
  </div>

  <!-- Pipeline Stages -->
  <div class="pipeline-stages">
    <!-- Stage 1: Build -->
    <div class="pipeline-stage">
      <div class="stage-header">
        <div class="stage-number">1</div>
        <div class="stage-info">
          <h3 class="stage-title">Build</h3>
          <p class="stage-subtitle">Create your infrastructure</p>
        </div>
      </div>
      <div class="stage-actions">
        <a href="{{ url_for('add_hosts') }}" class="stage-action">
          <div class="action-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="8.5" cy="7" r="4"/>
              <line x1="20" y1="8" x2="20" y2="14"/>
              <line x1="23" y1="11" x2="17" y2="11"/>
            </svg>
          </div>
          <div class="action-content">
            <span class="action-title">Add Hosts</span>
            <span class="action-desc">Build hosts.csv inventory</span>
          </div>
          <div class="action-arrow">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"/>
            </svg>
          </div>
        </a>
        <a href="{{ url_for('build_topology') }}" class="stage-action">
          <div class="action-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="12 2 2 7 12 12 22 7 12 2"/>
              <polyline points="2 17 12 22 22 17"/>
              <polyline points="2 12 12 17 22 12"/>
            </svg>
          </div>
          <div class="action-content">
            <span class="action-title">Build Topology</span>
            <span class="action-desc">Generate & deploy topology</span>
          </div>
          <div class="action-arrow">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"/>
            </svg>
          </div>
        </a>
      </div>
      <div class="stage-connector">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6 9 12 15 18 9"/>
        </svg>
      </div>
    </div>

    <!-- Stage 2: Configure -->
    <div class="pipeline-stage">
      <div class="stage-header">
        <div class="stage-number">2</div>
        <div class="stage-info">
          <h3 class="stage-title">Configure</h3>
          <p class="stage-subtitle">Set up your devices</p>
        </div>
      </div>
      <div class="stage-actions">
        <a href="{{ url_for('add_device') }}" class="stage-action">
          <div class="action-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="4" y="4" width="16" height="16" rx="2" ry="2"/>
              <line x1="12" y1="8" x2="12" y2="16"/>
              <line x1="8" y1="12" x2="16" y2="12"/>
            </svg>
          </div>
          <div class="action-content">
            <span class="action-title">Add Device</span>
            <span class="action-desc">Add to existing network</span>
          </div>
          <div class="action-arrow">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"/>
            </svg>
          </div>
        </a>
        <a href="{{ url_for('configure_device') }}" class="stage-action">
          <div class="action-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"/>
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
            </svg>
          </div>
          <div class="action-content">
            <span class="action-title">Configure Device</span>
            <span class="action-desc">Interfaces, VLANs, routing</span>
          </div>
          <div class="action-arrow">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"/>
            </svg>
          </div>
        </a>
      </div>
      <div class="stage-connector">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6 9 12 15 18 9"/>
        </svg>
      </div>
    </div>

    <!-- Stage 3: Manage -->
    <div class="pipeline-stage">
      <div class="stage-header">
        <div class="stage-number">3</div>
        <div class="stage-info">
          <h3 class="stage-title">Manage</h3>
          <p class="stage-subtitle">Operate your network</p>
        </div>
      </div>
      <div class="stage-actions">
        <a href="{{ url_for('tools') }}" class="stage-action">
          <div class="action-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
            </svg>
          </div>
          <div class="action-content">
            <span class="action-title">Tools</span>
            <span class="action-desc">Diagnostics & utilities</span>
          </div>
          <div class="action-arrow">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"/>
            </svg>
          </div>
        </a>
        <a href="{{ url_for('ipam') }}" class="stage-action">
          <div class="action-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <ellipse cx="12" cy="5" rx="9" ry="3"/>
              <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
              <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
            </svg>
          </div>
          <div class="action-content">
            <span class="action-title">IPAM</span>
            <span class="action-desc">IP address management</span>
          </div>
          <div class="action-arrow">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"/>
            </svg>
          </div>
        </a>
      </div>
      <div class="stage-connector">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6 9 12 15 18 9"/>
        </svg>
      </div>
    </div>

    <!-- Stage 4: Monitor -->
    <div class="pipeline-stage">
      <div class="stage-header">
        <div class="stage-number">4</div>
        <div class="stage-info">
          <h3 class="stage-title">Monitor</h3>
          <p class="stage-subtitle">Observe & analyze</p>
        </div>
      </div>
      <div class="stage-actions">
        <a href="{{ url_for('dashboard') }}" class="stage-action">
          <div class="action-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7"/>
              <rect x="14" y="3" width="7" height="7"/>
              <rect x="14" y="14" width="7" height="7"/>
              <rect x="3" y="14" width="7" height="7"/>
            </svg>
          </div>
          <div class="action-content">
            <span class="action-title">Dashboard</span>
            <span class="action-desc">Grafana monitoring</span>
          </div>
          <div class="action-arrow">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"/>
            </svg>
          </div>
        </a>
        <a href="{{ url_for('topology') }}" class="stage-action">
          <div class="action-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="18" cy="18" r="3"/>
              <circle cx="6" cy="6" r="3"/>
              <path d="M13 6h3a2 2 0 0 1 2 2v7"/>
              <line x1="6" y1="9" x2="6" y2="21"/>
            </svg>
          </div>
          <div class="action-content">
            <span class="action-title">Topology</span>
            <span class="action-desc">Network visualization</span>
          </div>
          <div class="action-arrow">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"/>
            </svg>
          </div>
        </a>
      </div>
    </div>
  </div>
</div>

<style>
/* Pipeline Container */
.pipeline-container {
  max-width: 900px;
  margin: 0 auto;
  padding: var(--space-6) 0;
}

.pipeline-header {
  display: flex;
  align-items: center;
  gap: var(--space-4);
  margin-bottom: var(--space-8);
}

.pipeline-label {
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold);
  text-transform: uppercase;
  letter-spacing: var(--letter-spacing-wide);
  color: var(--color-text-muted);
  white-space: nowrap;
}

.pipeline-connector-line {
  flex: 1;
  height: 2px;
  background: linear-gradient(90deg, var(--color-primary), var(--color-accent), transparent);
  border-radius: var(--radius-full);
}

/* Pipeline Stages */
.pipeline-stages {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
}

.pipeline-stage {
  background-color: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-xl);
  padding: var(--space-5);
  transition: all var(--transition-base);
  position: relative;
}

.pipeline-stage:hover {
  border-color: var(--color-primary);
  box-shadow: var(--shadow-md);
}

/* Stage Header */
.stage-header {
  display: flex;
  align-items: center;
  gap: var(--space-4);
  margin-bottom: var(--space-4);
}

.stage-number {
  width: 36px;
  height: 36px;
  border-radius: var(--radius-full);
  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
  color: white;
  font-weight: var(--font-weight-bold);
  font-size: var(--font-size-lg);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.stage-info {
  flex: 1;
}

.stage-title {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
  margin: 0;
}

.stage-subtitle {
  font-size: var(--font-size-sm);
  color: var(--color-text-tertiary);
  margin: 0;
}

/* Stage Actions */
.stage-actions {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-3);
}

.stage-action {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-4);
  background-color: var(--color-bg-secondary);
  border: 1px solid transparent;
  border-radius: var(--radius-lg);
  text-decoration: none;
  color: inherit;
  transition: all var(--transition-fast);
}

.stage-action:hover {
  background-color: var(--color-primary-light);
  border-color: var(--color-primary);
  transform: translateX(4px);
}

.action-icon {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--color-primary);
  flex-shrink: 0;
}

.action-content {
  flex: 1;
  min-width: 0;
}

.action-title {
  display: block;
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
}

.action-desc {
  display: block;
  font-size: var(--font-size-xs);
  color: var(--color-text-tertiary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.action-arrow {
  color: var(--color-text-muted);
  opacity: 0;
  transform: translateX(-4px);
  transition: all var(--transition-fast);
}

.stage-action:hover .action-arrow {
  opacity: 1;
  transform: translateX(0);
}

/* Stage Connector */
.stage-connector {
  position: absolute;
  left: 50%;
  bottom: -20px;
  transform: translateX(-50%);
  color: var(--color-border);
  z-index: 1;
}

.pipeline-stage:last-child .stage-connector {
  display: none;
}

/* Responsive */
@media (max-width: 768px) {
  .stage-actions {
    grid-template-columns: 1fr;
  }

  .stage-header {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-2);
  }

  .pipeline-container {
    padding: var(--space-4) 0;
  }
}

/* Rollback Banner */
.rollback-banner {
  max-width: 900px;
  margin: 0 auto var(--space-8) auto;
  background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
  border-radius: var(--radius-xl);
  padding: var(--space-6);
  box-shadow: 0 8px 24px rgba(220, 38, 38, 0.4);
  position: relative;
  overflow: hidden;
  animation: pulse-glow 3s ease-in-out infinite;
}

.rollback-banner::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  animation: shimmer 3s infinite;
}

@keyframes shimmer {
  0%, 100% { left: -100%; }
  50% { left: 100%; }
}

@keyframes pulse-glow {
  0%, 100% {
    box-shadow: 0 8px 24px rgba(220, 38, 38, 0.4);
  }
  50% {
    box-shadow: 0 8px 32px rgba(220, 38, 38, 0.6);
  }
}

.rollback-content {
  display: flex;
  align-items: center;
  gap: var(--space-5);
  position: relative;
  z-index: 1;
}

.rollback-icon {
  flex-shrink: 0;
  width: 56px;
  height: 56px;
  background: rgba(255, 255, 255, 0.15);
  border-radius: var(--radius-full);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  backdrop-filter: blur(10px);
}

.rollback-info {
  flex: 1;
}

.rollback-title {
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-bold);
  color: white;
  margin-bottom: var(--space-1);
  font-family: var(--font-family-display);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.rollback-desc {
  font-size: var(--font-size-sm);
  color: rgba(255, 255, 255, 0.9);
}

.btn-rollback {
  flex-shrink: 0;
  display: inline-flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-4) var(--space-6);
  background: white;
  color: #dc2626;
  border: none;
  border-radius: var(--radius-lg);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-semibold);
  cursor: pointer;
  transition: all var(--transition-fast);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.btn-rollback:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
  background: #fef2f2;
}

.btn-rollback:active {
  transform: translateY(0) scale(1);
}

/* Rollback Modal */
.rollback-modal {
  background: var(--color-surface);
  border-radius: var(--radius-xl);
  max-width: 500px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: var(--shadow-xl);
  animation: slideIn 0.3s ease-out;
}

.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-5);
  border-bottom: 1px solid var(--color-border);
}

.modal-title {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
  margin: 0;
}

.modal-close {
  background: transparent;
  border: none;
  color: var(--color-text-secondary);
  cursor: pointer;
  padding: var(--space-2);
  border-radius: var(--radius-md);
  transition: all var(--transition-fast);
}

.modal-close:hover {
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
}

.modal-body {
  padding: var(--space-5);
}

.modal-footer {
  display: flex;
  gap: var(--space-3);
  justify-content: flex-end;
  padding: var(--space-5);
  border-top: 1px solid var(--color-border);
  background: var(--color-bg-secondary);
}

@media (max-width: 768px) {
  .rollback-content {
    flex-direction: column;
    text-align: center;
  }

  .btn-rollback {
    width: 100%;
  }
}
</style>

<script>
function showRollbackModal() {
  document.getElementById('rollbackModal').style.display = 'flex';
}

function closeRollbackModal(event) {
  if (!event || event.target === event.currentTarget) {
    document.getElementById('rollbackModal').style.display = 'none';
    document.getElementById('rollbackDevice').value = '';
    document.getElementById('rollbackVendor').value = '';
  }
}

async function executeRollback() {
  const deviceId = document.getElementById('rollbackDevice').value;
  const deviceVendor = document.getElementById('rollbackVendor').value;

  if (!deviceId || !deviceVendor) {
    alert('Please select both device and vendor');
    return;
  }

  if (!confirm(`Are you sure you want to rollback ${deviceId} to its golden configuration?`)) {
    return;
  }

  try {
    const response = await fetch('/rollback', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        device_id: deviceId,
        device_vendor: deviceVendor
      })
    });

    const data = await response.json();

    if (data.status === 'success') {
      alert(`✅ ${data.message}`);
      closeRollbackModal();
    } else {
      alert(`❌ ${data.message}`);
    }
  } catch (error) {
    alert(`❌ Error: ${error.message}`);
  }
}
</script>
{% endblock %}
