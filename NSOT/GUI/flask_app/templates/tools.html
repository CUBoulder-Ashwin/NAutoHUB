{% extends "base.html" %}
{% block title %}Tools - NAutoHUB{% endblock %}

{% block content %}
<div class="page-header">
  <h1 class="page-title">Network Tools</h1>
  <p class="page-description">Diagnostic and management utilities for your network</p>
</div>

<div class="grid grid-cols-3 gap-6">
  <!-- Golden Config Generator -->
  <div class="tool-card">
    <div class="tool-card-header">
      <h3 class="tool-card-title">Golden Config Generator</h3>
      <p class="tool-card-description">Generate golden configuration snapshots</p>
    </div>
    <div class="tool-card-body">
      <form method="POST" class="form">
        <div class="form-group">
          <label class="form-label">Device Name</label>
          <input type="text" name="device" id="device-name" class="form-input" placeholder="Enter device name">
        </div>
        <div class="form-group">
          <label class="form-check">
            <input type="checkbox" id="select-all" name="select_all" class="form-check-input" onclick="toggleInputFields()">
            <span class="form-check-label">Select all devices from IPAM</span>
          </label>
        </div>
        <button type="submit" class="btn btn-primary btn-block">Generate Config</button>
      </form>
      {% if config_result %}
      <div class="output-container mt-4">{{ config_result|safe }}</div>
      {% endif %}
    </div>
  </div>

  <!-- Show Configs -->
  <div class="tool-card">
    <div class="tool-card-header">
      <h3 class="tool-card-title">Show Configs</h3>
      <p class="tool-card-description">Execute show commands on devices</p>
    </div>
    <div class="tool-card-body">
      <form method="POST" class="form">
        <div class="form-group">
          <label class="form-label">Select Device</label>
          <select name="selected_device" id="device-select" class="form-select">
            <option value="" disabled selected>Select Device</option>
            {% for device in devices %}
            <option value="{{ device }}">{{ device }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Command Category</label>
          <div class="grid grid-cols-1 gap-2">
            <select id="routing-dropdown" class="form-select form-input-sm" onchange="updateCommandField(this.value)">
              <option value="" disabled selected>Routing Protocols</option>
              <option value="show ip bgp summary">BGP Summary</option>
              <option value="show ip ospf neighbor">OSPF Neighbor</option>
              <option value="show ip rip database">RIP Database</option>
            </select>
            <select id="layer2-dropdown" class="form-select form-input-sm" onchange="updateCommandField(this.value)">
              <option value="" disabled selected>Layer 2 Info</option>
              <option value="show mac address-table">MAC Address Table</option>
              <option value="show lldp neighbors">LLDP Neighbors</option>
              <option value="show vlan brief">VLAN Brief</option>
            </select>
            <select id="general-dropdown" class="form-select form-input-sm" onchange="updateCommandField(this.value)">
              <option value="" disabled selected>General Info</option>
              <option value="show version">Version</option>
              <option value="show running-config">Running Config</option>
              <option value="show ip interface brief">IP Interface Brief</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Custom Command</label>
          <input type="text" id="custom-command" name="command" class="form-input" placeholder="e.g., show version">
        </div>
        <button type="submit" class="btn btn-primary btn-block">Execute Command</button>
      </form>
    </div>
  </div>

  <!-- Ping Test -->
  <div class="tool-card">
    <div class="tool-card-header">
      <h3 class="tool-card-title">Ping Test</h3>
      <p class="tool-card-description">Test network connectivity</p>
    </div>
    <div class="tool-card-body">
      <form method="POST" class="form">
        <div class="form-group">
          <label class="form-label">Source IP</label>
          <input type="text" name="source" class="form-input" placeholder="localhost" required>
        </div>
        <div class="form-group">
          <label class="form-label">Destination IP</label>
          <input type="text" name="destination" class="form-input" required>
        </div>
        <div class="form-group">
          <label class="form-label">SSH Username</label>
          <input type="text" name="username" class="form-input" placeholder="root">
        </div>
        <div class="form-group">
          <label class="form-label">SSH Password</label>
          <input type="password" name="password" class="form-input">
        </div>
        <button type="submit" class="btn btn-primary btn-block">Run Ping Test</button>
      </form>
      {% if ping_result %}
      <div class="output-container mt-4">{{ ping_result|safe }}</div>
      {% endif %}
    </div>
  </div>
</div>

{% if show_result %}
<div class="card card-elevated mt-6">
  <div class="card-header">
    <h4>Command Output</h4>
  </div>
  <div class="card-body">
    <pre class="output-container" style="max-height: 400px;">{{ show_result|safe }}</pre>
  </div>
</div>
{% endif %}

<script>
function toggleInputFields() {
  const selectAll = document.getElementById('select-all');
  const deviceName = document.getElementById('device-name');
  deviceName.disabled = selectAll.checked;
  if (selectAll.checked) {
    deviceName.value = '';
  }
}

function updateCommandField(value) {
  document.getElementById('custom-command').value = value;
}
</script>
{% endblock %}
