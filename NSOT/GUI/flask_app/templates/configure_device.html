{% extends "base.html" %}
{% block content %}

<h2 class="page-title">Configure Device</h2>
<form method="POST" class="form-container">
    <!-- Device Name -->
    <div class="form-group">
        <label for="device_id" class="form-label">Device Name:</label>
        <input type="text" name="device_id" required class="form-input">
    </div>

    <!-- Router Type Dropdown -->
    <div class="form-group">
        <label for="router_type" class="form-label">Select Router Type:</label>
        <select name="router_type" id="router_type" required class="form-input" onchange="showConfigInputs()">
            <option value="">Select Type</option>
            <option value="access">Access Router</option>
            <option value="core">Core Router</option>
            <option value="edge">Edge Router</option>
        </select>
    </div>

    <!-- Vendor -->
    <div class="form-group">
        <label for="device_vendor" class="form-label">Device Vendor:</label>
        <select name="device_vendor" id="device_vendor" required class="form-input">
            <option value="">Select Vendor</option>
            <option value="cisco">Cisco</option>
            <option value="arista">Arista</option>
            <option value="juniper">Juniper</option>
        </select>
    </div>

    <!-- Dynamic Section -->
    <div id="config_inputs"></div>

    <div class="form-group text-center">
        <button type="submit" class="form-button">Generate Configuration</button>
    </div>
</form>

{% if jenkins_result %}
    <div id="config-data" data-device-id="{{ device_id }}"></div>
    <div id="jenkins-result" class="jenkins-status {{ 'success' if jenkins_result == 'SUCCESS' else 'failure' }}">
        Jenkins Job Status: {{ jenkins_result }}
    </div>

    {% if jenkins_result == 'SUCCESS' %}
        <div style="text-align: center; margin-top: 20px;">
            <button type="button" onclick="pushConfiguration()" class="form-button">Push Configuration</button>
        </div>
    {% endif %}
{% endif %}

<script>
    function showConfigInputs() {
        const routerType = document.getElementById('router_type').value;
        const configInputs = document.getElementById('config_inputs');
        configInputs.innerHTML = routerType === 'access'
            ? '<p class="form-note">Access Router Fields...</p>'
            : routerType === 'core'
                ? '<p class="form-note">Core Router Fields...</p>'
                : '';
    }

    function pushConfiguration() {
        const deviceId = document.getElementById("config-data").dataset.deviceId;
        fetch("/push-config", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ device_id: deviceId }),
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === "success") {
                alert("Configuration pushed successfully!");
                window.location.href = "/";
            } else {
                alert("Failed to push configuration: " + data.message);
                window.location.href = "/configure-device";
            }
        })
        .catch(error => {
            alert("An error occurred while pushing the configuration.");
            console.error(error);
            window.location.href = "/configure-device";
        });
    }
</script>

<style>
:root {
    --dark-bg: #0d0d0d;
    --dark-accent: #d4a373;
    --dark-hover: #eec68d;
    --light-bg: #fdf6e3;
    --light-accent: #8b5e3c;
    --light-hover: #b07c59;
}

/* Shared */
body {
    font-family: Arial, sans-serif;
    background-color: inherit;
    color: inherit;
    margin: 0;
    padding: 0;
}

.page-title {
    text-align: center;
    font-family: 'Arial Black', sans-serif;
    margin: 20px 0;
}

/* Container */
.form-container {
    max-width: 600px;
    margin: 0 auto;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(0,0,0,0.4);
    background-color: inherit;
}

/* Form Elements */
.form-group {
    margin-bottom: 18px;
}

.form-label {
    display: block;
    font-weight: bold;
    margin-bottom: 6px;
}

.form-input,
select.form-input {
    width: 100%;
    padding: 10px;
    border-radius: 6px;
    border: 1px solid;
    background-color: inherit;
    color: inherit;
    transition: border-color 0.3s;
}

select.form-input option {
    background-color: var(--dark-bg);
    color: #f0e6d2;
}

.light-mode select.form-input option {
    background-color: var(--light-bg);
    color: #2e2e2e;
}

.form-input:focus,
select.form-input:focus {
    outline: none;
    box-shadow: 0 0 5px;
}

/* Buttons */
.form-button {
    padding: 10px 22px;
    font-size: 16px;
    font-weight: bold;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

/* Light Theme */
body.light-mode .page-title,
body.light-mode .form-label {
    color: var(--light-accent);
}

body.light-mode .form-container {
    background-color: var(--light-bg);
}

body.light-mode .form-input,
body.light-mode select.form-input {
    border-color: var(--light-accent);
    background-color: #fff;
    color: #2e2e2e;
}

body.light-mode .form-button {
    background-color: var(--light-accent);
    color: #fff;
}

body.light-mode .form-button:hover {
    background-color: var(--light-hover);
}

/* Dark Theme */
body.dark-mode .page-title,
body.dark-mode .form-label {
    color: var(--dark-accent);
}

body.dark-mode .form-container {
    background-color: var(--dark-bg);
}

body.dark-mode .form-input,
body.dark-mode select.form-input {
    border-color: var(--dark-accent);
    background-color: #0f0f0f;
    color: #f0e6d2;
}

body.dark-mode .form-button {
    background-color: var(--dark-accent);
    color: #000;
}

body.dark-mode .form-button:hover {
    background-color: var(--dark-hover);
}
</style>

{% endblock %}
